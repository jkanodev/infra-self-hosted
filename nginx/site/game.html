<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Snake on j-kano.site</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,Arial}
    body{display:flex;align-items:center;justify-content:center;background:#0b0f14;color:#e6edf3}
    .wrap{width:min(720px,95vw);text-align:center}
    canvas{width:100%;height:auto;aspect-ratio:1/1;background:#0f1720;border:1px solid #223041;border-radius:12px;touch-action:none}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:12px 0}
    button{background:#1f6feb;color:white;border:0;border-radius:10px;padding:10px 14px;font-weight:700}
    .pill{padding:8px 12px;border:1px solid #223041;border-radius:999px}
    .hint{opacity:.85;font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Snake</h1>
    <div class="row">
      <div class="pill">Score: <span id="score">0</span></div>
      <div class="pill">Level: <span id="level">1</span></div>
      <div class="pill">Speed: <span id="speed">1.0x</span></div>
    </div>
    <canvas id="c" width="600" height="600"></canvas>
    <div class="row">
      <button id="start">Start</button>
      <button id="pause">Pause</button>
      <button id="reset">Reset</button>
    </div>
    <div class="hint">Keyboard: arrows or WASD. Phone: swipe on the board.</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const scoreEl = document.getElementById("score");
  const levelEl = document.getElementById("level");
  const speedEl = document.getElementById("speed");
  const btnStart = document.getElementById("start");
  const btnPause = document.getElementById("pause");
  const btnReset = document.getElementById("reset");

  const grid = 24;
  const cell = canvas.width / grid;

  let snake, dir, nextDir, food, score, level, tickMs, timer, running, paused;

  function randCell() {
    return { x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*grid) };
  }

  function same(a,b){ return a.x===b.x && a.y===b.y; }

  function placeFood() {
    let f;
    do {
      f = randCell();
    } while (snake.some(s => same(s, f)));
    food = f;
  }

  function setSpeed() {
    const base = 140;
    const mult = Math.max(0.55, 1 - (level-1)*0.06);
    tickMs = Math.round(base * mult);
    speedEl.textContent = (base / tickMs).toFixed(1) + "x";
  }

  function reset() {
    snake = [{x:12,y:12},{x:11,y:12},{x:10,y:12}];
    dir = {x:1,y:0};
    nextDir = dir;
    score = 0;
    level = 1;
    running = false;
    paused = false;
    scoreEl.textContent = score;
    levelEl.textContent = level;
    setSpeed();
    placeFood();
    draw();
  }

  function start() {
    if (running) return;
    running = true;
    paused = false;
    loop();
  }

  function togglePause() {
    if (!running) return;
    paused = !paused;
    if (!paused) loop();
  }

  function gameOver() {
    running = false;
    paused = false;
    clearTimeout(timer);
    timer = null;
    ctx.fillStyle = "rgba(0,0,0,.55)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = "bold 36px system-ui";
    ctx.textAlign = "center";
    ctx.fillText("Game Over", canvas.width/2, canvas.height/2 - 10);
    ctx.font = "16px system-ui";
    ctx.fillText("Press Reset or Start", canvas.width/2, canvas.height/2 + 22);
  }

  function step() {
    if (!running || paused) return;

    dir = nextDir;

    const head = snake[0];
    const newHead = { x: head.x + dir.x, y: head.y + dir.y };

    if (newHead.x < 0 || newHead.x >= grid || newHead.y < 0 || newHead.y >= grid) {
      return gameOver();
    }

    if (snake.some((s, i) => i !== 0 && same(s, newHead))) {
      return gameOver();
    }

    snake.unshift(newHead);

    if (same(newHead, food)) {
      score += 10;
      scoreEl.textContent = score;

      const newLevel = 1 + Math.floor(score / 100);
      if (newLevel !== level) {
        level = newLevel;
        levelEl.textContent = level;
        setSpeed();
      }

      placeFood();
    } else {
      snake.pop();
    }

    draw();
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle = "rgba(255,255,255,.06)";
    for (let i=0;i<=grid;i++){
      ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,canvas.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(canvas.width,i*cell); ctx.stroke();
    }

    ctx.fillStyle = "#ff5a5f";
    ctx.beginPath();
    ctx.arc((food.x+0.5)*cell, (food.y+0.5)*cell, cell*0.28, 0, Math.PI*2);
    ctx.fill();

    for (let i=0;i<snake.length;i++){
      const s = snake[i];
      const pad = i===0 ? 2 : 4;
      const r = 10;
      ctx.fillStyle = i===0 ? "#2ea043" : "#3fb950";
      roundRect(ctx, s.x*cell+pad, s.y*cell+pad, cell-pad*2, cell-pad*2, r);
      ctx.fill();
    }
  }

  function roundRect(ctx,x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr);
    ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr);
    ctx.arcTo(x,y,x+w,y,rr);
    ctx.closePath();
  }

  function loop(){
    step();
    if (running && !paused) timer = setTimeout(loop, tickMs);
  }

  function setDir(nx, ny){
    if (dir.x === -nx && dir.y === -ny) return;
    nextDir = {x:nx,y:ny};
  }

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "arrowup" || k === "w") setDir(0,-1);
    if (k === "arrowdown" || k === "s") setDir(0,1);
    if (k === "arrowleft" || k === "a") setDir(-1,0);
    if (k === "arrowright" || k === "d") setDir(1,0);
    if (k === " ") togglePause();
  });

  let touchStart = null;
  canvas.addEventListener("pointerdown", (e) => {
    canvas.setPointerCapture(e.pointerId);
    touchStart = { x: e.clientX, y: e.clientY };
  });
  canvas.addEventListener("pointerup", (e) => {
    if (!touchStart) return;
    const dx = e.clientX - touchStart.x;
    const dy = e.clientY - touchStart.y;
    touchStart = null;
    if (Math.abs(dx) < 18 && Math.abs(dy) < 18) return;
    if (Math.abs(dx) > Math.abs(dy)) setDir(dx>0 ? 1 : -1, 0);
    else setDir(0, dy>0 ? 1 : -1);
  });

  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", togglePause);
  btnReset.addEventListener("click", () => { reset(); start(); });

  reset();
})();
</script>
</body>
</html>
