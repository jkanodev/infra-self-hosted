<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Snake</title>
  <style>
    :root{--bg:#05060b;--cyan:#00ffff;--pink:#ff00ff;--green:#00ff88;--text:#e8f0ff;--muted:#94a3b8}
    *{box-sizing:border-box;touch-action:none;-webkit-user-select:none;user-select:none}
    body{margin:0;background:radial-gradient(900px 600px at 20% 20%, rgba(0,255,255,.10), transparent 55%),
                    radial-gradient(900px 600px at 80% 30%, rgba(255,0,255,.08), transparent 55%),var(--bg);
         color:var(--text);font-family:ui-monospace, Menlo, Consolas, monospace;overflow:hidden}
    #wrap{position:fixed;inset:0;display:flex;flex-direction:column}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.25)}
    .title{letter-spacing:.14em;text-transform:uppercase}
    .sub{color:var(--muted);font-size:12px}
    #hud{display:flex;gap:14px;align-items:center;color:var(--muted);font-size:12px}
    #hud b{color:var(--text)}
    canvas{flex:1;display:block}
    #controls{display:flex;gap:10px;justify-content:center;align-items:center;padding:12px;border-top:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.25)}
    button{padding:12px 16px;border:1px solid rgba(0,255,255,.35);background:transparent;color:var(--cyan);
           font-family:inherit;letter-spacing:.12em;text-transform:uppercase;border-radius:12px}
    button:active{transform:scale(.98)}
    #oneBtn{border-color:rgba(255,0,255,.35);color:var(--pink)}
    .hint{color:var(--muted);font-size:12px;text-align:center;padding:8px 14px}
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <div>
      <div class="title">Snake</div>
      <div class="sub">One button to turn plus swipe or arrows to move</div>
    </div>
    <div id="hud">
      <div>score <b id="score">0</b></div>
      <div>level <b id="level">1</b></div>
      <div>speed <b id="speed">1x</b></div>
    </div>
  </header>

  <canvas id="c"></canvas>

  <div class="hint">Desktop arrows or WASD. Mobile swipe. One button turns right.</div>

  <div id="controls">
    <button id="oneBtn">Turn</button>
    <button id="restartBtn">Restart</button>
    <button onclick="location.href='/'">Home</button>
  </div>
</div>

<script>
  const c = document.getElementById('c')
  const x = c.getContext('2d')

  function fit(){
    const dpr = devicePixelRatio || 1
    const w = innerWidth
    const h = innerHeight - 140
    c.width = Math.floor(w * dpr)
    c.height = Math.floor(h * dpr)
    c.style.width = w + 'px'
    c.style.height = h + 'px'
    x.setTransform(dpr,0,0,dpr,0,0)
  }
  addEventListener('resize', fit)
  fit()

  const uiScore = document.getElementById('score')
  const uiLevel = document.getElementById('level')
  const uiSpeed = document.getElementById('speed')

  let grid = 22
  let cell = 0
  let cols = 0
  let rows = 0

  function calcGrid(){
    const w = c.clientWidth
    const h = c.clientHeight
    cell = Math.floor(Math.min(w,h) / grid)
    cols = Math.floor(w / cell)
    rows = Math.floor(h / cell)
  }
  calcGrid()

  const DIRS = [
    {x:1,y:0},
    {x:0,y:1},
    {x:-1,y:0},
    {x:0,y:-1},
  ]

  let snake, dir, nextDir, food, score, level, tickMs, last, alive
  let turnClockwise = true

  function reset(){
    calcGrid()
    snake = [{x:Math.floor(cols/2), y:Math.floor(rows/2)}]
    dir = 0
    nextDir = 0
    score = 0
    level = 1
    tickMs = 140
    last = 0
    alive = true
    spawnFood()
    renderHud()
  }

  function renderHud(){
    uiScore.textContent = score
    uiLevel.textContent = level
    uiSpeed.textContent = (Math.round((140/tickMs)*10)/10) + 'x'
  }

  function spawnFood(){
    while(true){
      const fx = 1 + Math.floor(Math.random()*(cols-2))
      const fy = 1 + Math.floor(Math.random()*(rows-2))
      if(!snake.some(s=>s.x===fx && s.y===fy)){
        food = {x:fx,y:fy}
        return
      }
    }
  }

  function turn(){
    if(!alive) return
    nextDir = (dir + (turnClockwise ? 1 : 3)) % 4
  }

  function step(){
    dir = nextDir
    const head = snake[0]
    const d = DIRS[dir]
    const nx = head.x + d.x
    const ny = head.y + d.y

    if(nx<0 || ny<0 || nx>=cols || ny>=rows) { alive=false; return }
    if(snake.some((s,i)=>i && s.x===nx && s.y===ny)) { alive=false; return }

    snake.unshift({x:nx,y:ny})

    if(nx===food.x && ny===food.y){
      score += 10
      if(score % 50 === 0){
        level += 1
        tickMs = Math.max(60, tickMs - 10)
      }
      spawnFood()
      renderHud()
    } else {
      snake.pop()
    }
  }

  function draw(){
    const w = c.clientWidth
    const h = c.clientHeight

    x.clearRect(0,0,w,h)

    x.fillStyle = 'rgba(0,255,255,.06)'
    for(let i=0;i<cols;i++){
      x.fillRect(i*cell, 0, 1, h)
    }
    for(let j=0;j<rows;j++){
      x.fillRect(0, j*cell, w, 1)
    }

    x.fillStyle = '#ff00ff'
    x.shadowBlur = 18
    x.shadowColor = '#ff00ff'
    x.fillRect(food.x*cell+3, food.y*cell+3, cell-6, cell-6)
    x.shadowBlur = 0

    for(let i=0;i<snake.length;i++){
      const s = snake[i]
      x.fillStyle = i===0 ? '#00ffff' : '#00ff88'
      x.shadowBlur = i===0 ? 22 : 0
      x.shadowColor = '#00ffff'
      x.fillRect(s.x*cell+2, s.y*cell+2, cell-4, cell-4)
      x.shadowBlur = 0
    }

    if(!alive){
      x.fillStyle = 'rgba(0,0,0,.55)'
      x.fillRect(0,0,w,h)
      x.fillStyle = '#e8f0ff'
      x.textAlign = 'center'
      x.font = '700 22px ui-monospace, Menlo, Consolas, monospace'
      x.fillText('GAME OVER', w/2, h/2 - 10)
      x.font = '14px ui-monospace, Menlo, Consolas, monospace'
      x.fillStyle = '#94a3b8'
      x.fillText('Tap Restart', w/2, h/2 + 16)
    }
  }

  function loop(t){
    if(alive && t - last > tickMs){
      last = t
      step()
    }
    draw()
    requestAnimationFrame(loop)
  }

  document.getElementById('oneBtn').addEventListener('click', turn)
  document.getElementById('restartBtn').addEventListener('click', reset)

  addEventListener('keydown', e=>{
    const k = e.code
    if(k==='ArrowUp' || k==='KeyW') nextDir = 3
    if(k==='ArrowRight' || k==='KeyD') nextDir = 0
    if(k==='ArrowDown' || k==='KeyS') nextDir = 1
    if(k==='ArrowLeft' || k==='KeyA') nextDir = 2
    if(k==='Space') turn()
    if(k==='KeyR') reset()
  })

  let sx=0, sy=0
  c.addEventListener('touchstart', e=>{
    const t = e.touches[0]
    sx=t.clientX; sy=t.clientY
  }, {passive:true})
  c.addEventListener('touchend', e=>{
    const t = e.changedTouches[0]
    const dx=t.clientX-sx, dy=t.clientY-sy
    if(Math.abs(dx)+Math.abs(dy) < 18){ turn(); return }
    if(Math.abs(dx) > Math.abs(dy)){
      nextDir = dx>0 ? 0 : 2
    } else {
      nextDir = dy>0 ? 1 : 3
    }
  }, {passive:true})

  reset()
  requestAnimationFrame(loop)
</script>
</body>
</html>
